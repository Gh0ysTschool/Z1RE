<html>
    <body>

    </body>
<script>

    /*
    init
     generate gamestate
     
    gameloop
     update
      handle collision
      handle input
      handle interaction

     render
      draw border
      draw tiles
      draw sprites
      draw ui / menus / start screens

    */
    // Create the canvas

    //globals
    var lastTime, ctx, canvas, now, dt, sprite_sheet, viewport, map_data, collisions, interactions_live, sprite_sheets, enemies;
    let link = {
        position: {
            x : 5,
            y : 8,
        },
        potential_position: {
            x : 5,
            y : 8,
        },
        speed : 5 ,
        walking_index : 0,
        direction : {
            x: 0,
            y: 0,
        },
        is_attacking : false,
        attack_frames : 40, 
        current_attack_frame : 0,
        wind_up_attack_frames : 10,
        recovery_attack_frames : 10,
        weapons : {
            'wooden sword': {
                quantity : 1,
                damage : 1,
                position : null,
                hitbox_dimensions : { w : 16, h : 4 }, // in pixels
                hitbox_offset : { x : 6, y : 0 }, // in pixels
                direction : null,
                collided : false,
            },
        },
        items : {
            'wooden shield':{
                quantity : 1,
            }
        },
        active_weapons : null,
        equiped_weapon : this.weapons['wooden sword'],

    }
    let room = {
        coordinates : {x:7,y:7},
        sprite_map : [],
        collision_map : [],
        enemies : [],
        damage_instances : [],

    }
    //the 255 different columns that LoZ uses in varying combinations to create each overworld screen's background sprites
    let column_data = [
        [61, 61, 61, 61, 61, 61, 61, 61, 61, 61, 61],[61, 61, 61, 61, 61, 2, 20, 20, 20, 20, 20],[61, 61, 61, 61, 61, 2, 41, 61, 61, 61, 61]
        ,[61, 61, 61, 62, 2, 2, 2, 42, 61, 61, 61],[61, 61, 60, 2, 2, 2, 2, 2, 2, 41, 61],[61, 61, 61, 61, 60, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 61, 61, 62, 2, 2, 2, 2, 41, 61],[61, 61, 61, 61, 61, 2, 2, 2, 2, 41, 61],[61, 61, 61, 61, 61, 2, 2, 2, 2, 20, 20]
        ,[61, 61, 2, 2, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 62, 2, 2, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 60, 2, 2, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 62, 2, 2, 2, 2, 2, 2, 2, 42, 61]
        ,[61, 60, 2, 2, 2, 2, 2, 2, 2, 40, 61]
        ,[61, 61, 61, 60, 2, 2, 2, 40, 61, 61, 61]
        ,[61, 61, 61, 61, 60, 2, 40, 61, 61, 61, 61]
        ,[61, 61, 61, 61, 62, 2, 42, 61, 61, 61, 61]
        ,[61, 61, 62, 2, 2, 2, 2, 2, 42, 61, 61]
        ,[61, 61, 61, 60, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 60, 2, 2, 2, 2, 2, 40, 61, 61]
        ,[61, 61, 61, 61, 61, 62, 2, 2, 42, 61, 61]
        ,[61, 61, 61, 61, 61, 60, 2, 2, 40, 61, 61]
        ,[61, 61, 61, 62, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 62, 2, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 18, 2, 2, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 40, 61, 60, 2, 2, 41, 61]
        ,[61, 61, 2, 40, 61, 61, 61, 2, 2, 41, 61]
        ,[61, 61, 2, 42, 61, 61, 61, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 42, 61, 62, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 2, 1, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 1, 2, 1, 2, 2, 41, 61]
        ,[61, 61, 2, 1, 2, 1, 2, 1, 2, 41, 61]
        ,[61, 61, 2, 80, 100, 100, 120, 2, 2, 41, 61]
        ,[61, 61, 2, 81, 101, 101, 121, 2, 2, 41, 61]
        ,[61, 61, 2, 81, 101, 101, 101, 141, 2, 41, 61]
        ,[61, 61, 2, 81, 101, 101, 101, 101, 101, 101, 101]
        ,[61, 61, 2, 81, 101, 101, 101, 140, 2, 41, 61]
        ,[61, 61, 2, 82, 102, 102, 122, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 2, 2, 2, 2, 2, 20, 20]
        ,[61, 61, 2, 2, 22, 2, 22, 2, 2, 41, 61]
        ,[61, 61, 2, 43, 63, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 44, 18, 2, 2, 2, 2, 20, 20]
        ,[61, 61, 2, 45, 65, 2, 2, 2, 2, 41, 61]
        ,[101, 101, 101, 61, 61, 61, 61, 61, 61, 61, 61]
        ,[101, 101, 101, 61, 18, 2, 2, 2, 20, 20, 20]
        ,[101, 101, 101, 101, 101, 101, 101, 101, 101, 101, 101]
        ,[61, 61, 2, 156, 18, 2, 2, 2, 2, 20, 20]
        ,[20, 20, 2, 2, 2, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 3, 23, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 5, 25, 2, 3, 23, 2, 41, 61]
        ,[61, 61, 2, 2, 2, 2, 5, 25, 2, 41, 61]
        ,[61, 61, 2, 5, 25, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 2, 2, 3, 23, 2, 41, 61]
        ,[61, 61, 2, 3, 23, 2, 5, 25, 2, 41, 61]
        ,[20, 20, 20, 20, 20, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 61, 61, 80, 101, 101, 101, 101, 101, 101]
        ,[61, 61, 61, 61, 121, 2, 2, 2, 2, 2, 2]
        ,[61, 61, 61, 61, 121, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 61, 61, 121, 2, 2, 41, 61, 61, 61]
        ,[144, 144, 144, 144, 70, 2, 2, 41, 61, 61, 61]
        ,[20, 20, 2, 2, 2, 2, 2, 2, 2, 20, 20]
        ,[61, 61, 61, 61, 61, 2, 2, 2, 2, 2, 2]
        ,[61, 61, 61, 61, 61, 2, 80, 100, 100, 100, 100]
        ,[61, 61, 61, 62, 2, 2, 81, 101, 101, 101, 101]
        ,[61, 61, 61, 60, 2, 2, 81, 101, 101, 101, 101]
        ,[61, 61, 61, 61, 2, 2, 81, 101, 101, 101, 101]
        ,[20, 20, 20, 20, 2, 2, 81, 101, 101, 101, 101]
        ,[61, 61, 2, 9, 29, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 11, 31, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 2, 2, 9, 29, 2, 41, 61]
        ,[61, 61, 2, 9, 29, 2, 11, 31, 2, 41, 61]
        ,[61, 61, 2, 10, 18, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 2, 2, 2, 11, 31, 2, 41, 61]
        ,[61, 61, 2, 11, 31, 2, 9, 29, 2, 41, 61]
        ,[73, 73, 73, 73, 73, 73, 73, 73, 73, 73, 73]
        ,[73, 73, 74, 14, 14, 14, 14, 14, 14, 14, 14]
        ,[73, 73, 14, 33, 14, 33, 14, 33, 14, 14, 14]
        ,[73, 73, 14, 14, 14, 14, 14, 14, 14, 14, 14]
        ,[73, 73, 14, 14, 14, 14, 14, 14, 14, 53, 73]
        ,[8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8]
        ,[61, 61, 14, 14, 14, 14, 14, 14, 14, 41, 61]
        ,[61, 61, 14, 14, 34, 14, 34, 14, 14, 41, 61]
        ,[61, 61, 14, 55, 75, 14, 14, 14, 14, 41, 61]
        ,[61, 61, 14, 56, 18, 14, 14, 14, 14, 20, 20]
        ,[61, 61, 14, 56, 18, 14, 14, 14, 14, 41, 61]
        ,[61, 61, 14, 57, 77, 14, 14, 14, 14, 41, 61]
        ,[61, 61, 2, 2, 2, 2, 2, 2, 2, 2, 2]
        ,[61, 61, 2, 2, 2, 2, 80, 100, 100, 100, 100]
        ,[2, 2, 2, 2, 2, 142, 101, 101, 101, 101, 101]
        ,[2, 2, 2, 2, 2, 2, 81, 101, 101, 101, 101]
        ,[61, 61, 2, 2, 2, 2, 81, 101, 101, 101, 101]
        ,[21, 21, 2, 2, 2, 2, 81, 101, 101, 101, 101]
        ,[21, 21, 2, 2, 2, 2, 87, 107, 107, 101, 101]
        ,[21, 21, 2, 2, 2, 2, 88, 108, 108, 102, 102]
        ,[21, 21, 2, 2, 2, 2, 2, 2, 2, 2, 2]
        ,[21, 21, 2, 2, 2, 2, 2, 2, 2, 21, 21]
        ,[21, 21, 2, 27, 2, 27, 2, 27, 2, 21, 21]
        ,[21, 21, 2, 2, 27, 2, 27, 2, 2, 21, 21]
        ,[21, 21, 21, 2, 2, 2, 2, 2, 21, 21, 21]
        ,[61, 61, 64, 64, 64, 64, 64, 64, 64, 41, 61]
        ,[61, 61, 64, 64, 64, 64, 64, 64, 64, 64, 64]
        ,[61, 61, 2, 61, 61, 61, 61, 2, 2, 41, 61]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
        ,[100, 100, 100, 100, 120, 2, 2, 2, 2, 41, 61]
        ,[101, 101, 101, 101, 121, 2, 2, 2, 2, 41, 61]
        ,[101, 101, 101, 101, 121, 2, 2, 2, 2, 2, 2]
        ,[101, 101, 101, 101, 101, 141, 2, 2, 2, 2, 2]
        ,[101, 101, 101, 101, 101, 101, 100, 100, 100, 100, 100]
        ,[73, 73, 14, 55, 75, 14, 14, 14, 14, 53, 73]
        ,[73, 73, 14, 57, 77, 14, 14, 14, 14, 53, 73]
        ,[73, 73, 14, 150, 18, 14, 14, 14, 14, 32, 32]
        ,[14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14]
        ,[14, 14, 14, 33, 14, 33, 14, 33, 14, 14, 14]
        ,[73, 72, 14, 14, 14, 14, 14, 14, 14, 52, 73]
        ,[73, 74, 14, 14, 14, 14, 14, 14, 14, 54, 73]
        ,[8, 8, 8, 8, 14, 14, 14, 8, 8, 8, 8]
        ,[20, 20, 14, 14, 14, 14, 14, 14, 14, 41, 61]
        ,[61, 61, 61, 61, 61, 61, 101, 101, 101, 101, 101]
        ,[61, 61, 2, 4, 18, 2, 2, 2, 2, 41, 61]
        ,[101, 101, 101, 101, 101, 145, 101, 101, 101, 101, 101]
        ,[102, 102, 102, 102, 102, 145, 102, 102, 102, 102, 102]
        ,[21, 21, 2, 2, 21, 2, 21, 2, 2, 21, 21]
        ,[21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21]
        ,[61, 61, 2, 2, 27, 2, 27, 2, 2, 41, 61]
        ,[61, 61, 2, 86, 106, 106, 126, 2, 2, 41, 61]
        ,[61, 61, 2, 87, 107, 107, 127, 2, 2, 41, 61]
        ,[61, 61, 2, 87, 107, 107, 127, 2, 2, 2, 2]
        ,[61, 61, 2, 88, 108, 108, 128, 2, 2, 41, 61]
        ,[64, 64, 64, 64, 64, 64, 64, 64, 64, 41, 61]
        ,[64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64]
        ,[67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67]
        ,[67, 67, 67, 68, 2, 2, 2, 48, 67, 67, 67]
        ,[67, 67, 68, 2, 2, 2, 2, 2, 48, 67, 67]
        ,[67, 67, 2, 2, 28, 2, 28, 2, 2, 47, 67]
        ,[67, 67, 2, 2, 2, 2, 2, 2, 2, 47, 67]
        ,[67, 67, 2, 49, 69, 2, 2, 2, 2, 47, 67]
        ,[67, 67, 2, 50, 18, 2, 2, 2, 2, 26, 26]
        ,[67, 67, 2, 51, 71, 2, 2, 2, 2, 47, 67]
        ,[67, 68, 2, 2, 2, 2, 2, 2, 2, 47, 67]
        ,[67, 66, 2, 2, 2, 2, 2, 2, 2, 47, 67]
        ,[67, 67, 66, 2, 2, 2, 2, 2, 46, 67, 67]
        ,[27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27]
        ,[27, 27, 2, 2, 2, 2, 2, 2, 2, 2, 2]
        ,[27, 27, 2, 27, 2, 27, 2, 27, 2, 27, 27]
        ,[27, 27, 2, 2, 28, 2, 2, 2, 2, 27, 27]
        ,[27, 27, 2, 2, 27, 2, 27, 2, 2, 27, 27]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 42, 61, 61]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 41, 61]
        ,[101, 101, 101, 101, 145, 2, 2, 2, 2, 2, 2]
        ,[14, 14, 14, 14, 14, 14, 14, 14, 54, 73, 73]
        ,[14, 14, 14, 33, 14, 33, 14, 33, 14, 53, 73]
        ,[14, 14, 14, 14, 14, 14, 14, 14, 14, 53, 73]
        ,[73, 73, 14, 14, 14, 14, 14, 14, 14, 32, 32]
        ,[61, 61, 2, 2, 21, 2, 21, 2, 2, 41, 61]
        ,[61, 61, 2, 81, 101, 101, 121, 2, 2, 2, 2]
        ,[100, 100, 106, 106, 106, 106, 106, 106, 106, 100, 100]
        ,[101, 101, 107, 107, 107, 107, 107, 107, 107, 101, 101]
        ,[61, 61, 2, 49, 69, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 51, 71, 2, 2, 2, 2, 41, 61]
        ,[61, 61, 2, 30, 18, 2, 2, 2, 2, 20, 20]
        ,[107, 107, 107, 107, 107, 107, 107, 107, 107, 107, 107]
        ,[107, 107, 107, 107, 107, 107, 108, 108, 108, 108, 108]
        ,[107, 107, 107, 107, 107, 146, 2, 2, 2, 2, 2]
        ,[107, 107, 107, 107, 127, 2, 2, 2, 2, 2, 2]
        ,[107, 107, 107, 107, 127, 2, 2, 27, 27, 27, 27]
        ,[107, 107, 107, 107, 127, 2, 2, 2, 2, 27, 27]
        ,[108, 108, 108, 108, 128, 2, 2, 2, 2, 27, 27]
        ,[27, 27, 2, 2, 2, 2, 2, 2, 2, 27, 27]
        ,[27, 27, 2, 2, 2, 7, 2, 2, 2, 27, 27]
        ,[27, 27, 27, 27, 2, 2, 2, 27, 27, 27, 27]
        ,[67, 67, 67, 66, 2, 2, 2, 46, 67, 67, 67]
        ,[67, 68, 2, 2, 2, 2, 2, 2, 2, 48, 67]
        ,[67, 66, 2, 2, 2, 2, 2, 2, 2, 46, 67]
        ,[67, 67, 2, 2, 27, 2, 27, 2, 2, 47, 67]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 47, 67]
        ,[67, 18, 2, 2, 2, 2, 2, 2, 2, 47, 67]
        ,[27, 27, 2, 2, 2, 27, 2, 2, 2, 27, 27]
        ,[67, 67, 67, 67, 66, 2, 2, 2, 2, 47, 67]
        ,[26, 26, 26, 26, 26, 2, 2, 2, 2, 47, 67]
        ,[67, 67, 67, 67, 67, 2, 2, 2, 2, 47, 67]
        ,[67, 67, 67, 67, 68, 2, 2, 2, 2, 47, 67]
        ,[67, 67, 67, 67, 66, 2, 46, 67, 67, 67, 67]
        ,[67, 67, 67, 67, 67, 2, 47, 67, 67, 67, 67]
        ,[67, 67, 67, 67, 68, 2, 48, 67, 67, 67, 67]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 27, 27]
        ,[27, 27, 27, 2, 2, 2, 2, 2, 27, 27, 27]
        ,[100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100]
        ,[73, 73, 73, 73, 73, 14, 14, 14, 14, 14, 14]
        ,[32, 32, 32, 32, 32, 14, 14, 14, 14, 53, 73]
        ,[21, 21, 21, 21, 2, 2, 2, 21, 21, 21, 21]
        ,[21, 21, 2, 21, 21, 21, 21, 21, 2, 21, 21]
        ,[21, 21, 2, 21, 21, 21, 21, 21, 2, 2, 2]
        ,[2, 2, 2, 21, 21, 21, 21, 21, 2, 21, 21]
        ,[21, 21, 2, 2, 2, 27, 2, 2, 2, 21, 21]
        ,[106, 106, 106, 106, 126, 2, 2, 2, 2, 2, 2]
        ,[107, 107, 107, 107, 127, 2, 47, 67, 67, 67, 67]
        ,[107, 107, 107, 107, 107, 147, 2, 2, 2, 2, 2]
        ,[107, 107, 107, 107, 151, 2, 2, 2, 2, 2, 2]
        ,[107, 107, 107, 107, 127, 2, 2, 2, 2, 47, 67]
        ,[27, 27, 27, 27, 2, 2, 86, 106, 106, 106, 106]
        ,[27, 27, 27, 27, 2, 2, 87, 107, 107, 107, 107]
        ,[27, 27, 2, 2, 2, 2, 87, 107, 107, 107, 107]
        ,[27, 27, 2, 2, 2, 2, 88, 108, 108, 108, 108]
        ,[27, 27, 2, 27, 27, 27, 27, 27, 2, 27, 27]
        ,[27, 27, 2, 27, 27, 27, 27, 27, 2, 2, 2]
        ,[27, 27, 2, 27, 27, 27, 27, 27, 27, 27, 27]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 21, 21]
        ,[2, 2, 2, 2, 2, 2, 2, 21, 21, 21, 21]
        ,[21, 21, 2, 21, 2, 21, 2, 21, 2, 21, 21]
        ,[21, 21, 2, 2, 2, 21, 2, 2, 2, 21, 21]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 48, 67]
        ,[107, 107, 101, 101, 101, 145, 101, 101, 101, 107, 107]
        ,[67, 67, 2, 1, 2, 1, 2, 1, 2, 47, 67]
        ,[67, 67, 2, 2, 1, 2, 1, 2, 2, 47, 67]
        ,[67, 67, 2, 2, 2, 2, 2, 2, 2, 48, 67]
        ,[67, 67, 2, 2, 2, 2, 2, 2, 2, 2, 2]
        ,[67, 67, 2, 7, 2, 7, 2, 7, 2, 47, 67]
        ,[106, 106, 106, 106, 126, 2, 2, 2, 2, 27, 27]
        ,[2, 2, 2, 2, 2, 2, 2, 27, 27, 27, 27]
        ,[61, 61, 2, 2, 2, 2, 2, 2, 2, 41, 41]
        ,[61, 61, 2, 3, 23, 2, 2, 2, 2, 41, 41]
        ,[61, 61, 2, 5, 25, 2, 3, 23, 2, 41, 41]
        ,[61, 61, 2, 2, 2, 2, 5, 25, 2, 41, 41]
        ,[61, 18, 2, 2, 2, 2, 2, 2, 2, 41, 41]
        ,[61, 62, 2, 2, 2, 2, 2, 2, 2, 41, 41]
        ,[61, 60, 2, 2, 2, 2, 2, 2, 2, 41, 41]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 41, 41]
        ,[21, 21, 21, 21, 21, 2, 2, 2, 2, 21, 21]
        ,[67, 67, 2, 2, 2, 2, 2, 2, 2, 47, 47]
        ,[67, 67, 2, 2, 22, 2, 22, 2, 2, 47, 47]
        ,[67, 67, 2, 43, 63, 2, 2, 2, 2, 47, 47]
        ,[67, 67, 2, 156, 18, 2, 2, 2, 2, 47, 47]
        ,[67, 67, 2, 45, 65, 2, 2, 2, 2, 47, 47]
        ,[67, 18, 2, 2, 2, 2, 2, 2, 2, 47, 47]
        ,[67, 68, 2, 2, 2, 7, 2, 2, 2, 47, 47]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 48, 48]
        ,[67, 66, 2, 2, 2, 2, 2, 2, 2, 46, 46]
        ,[67, 67, 2, 7, 2, 7, 2, 7, 2, 47, 47]
        ,[67, 67, 2, 2, 7, 2, 7, 2, 2, 47, 47]
        ,[67, 67, 2, 2, 2, 7, 2, 2, 2, 47, 47]
        ,[67, 68, 2, 2, 2, 2, 2, 2, 2, 47, 47]
        ,[2, 2, 2, 2, 2, 2, 2, 2, 2, 47, 47]
        ,[67, 67, 67, 68, 2, 2, 2, 2, 2, 47, 47]
        ,[67, 67, 68, 2, 2, 2, 2, 2, 2, 47, 47]
        ,[67, 67, 67, 67, 66, 2, 2, 2, 2, 47, 47]
        ,[67, 67, 67, 67, 67, 2, 2, 2, 2, 47, 47]
        ,[61, 60, 2, 2, 2, 2, 2, 2, 2, 40, 40]
        ,[61, 61, 60, 2, 2, 2, 2, 2, 2, 41, 41]
        ,[61, 61, 61, 60, 2, 2, 2, 2, 2, 41, 41]
        ,[61, 61, 61, 61, 60, 2, 2, 2, 2, 41, 41]
        ,[61, 62, 2, 2, 2, 2, 2, 2, 2, 42, 42]
        ,[61, 61, 2, 2, 2, 1, 2, 2, 2, 41, 41]
        ,[61, 61, 2, 2, 1, 2, 1, 2, 2, 41, 41]
        ,[2, 2, 2, 2, 2, 143, 101, 101, 101, 101, 101]
        ,[100, 100, 100, 100, 100, 101, 101, 101, 101, 101, 101]
    ];
    //the 38 different columns that LoZ uses in varying combinations to create each overworld screen's collision data
    let column_collision_data = [
        [0,0,0,0,0,0,0,0,0,0,0,],
        [0,0,0,0,0,0,0,0,0,1,1,],
        [0,0,0,0,0,0,0,0,1,1,1,],
        [0,0,0,0,0,0,0,1,1,1,1,],
        [0,0,0,0,0,0,1,1,1,1,1,],
        [0,0,0,1,0,1,0,1,0,0,0,],
        [0,0,0,1,0,1,0,1,0,1,1,],
        [0,0,0,1,1,1,1,1,0,1,1,],
        [1,1,0,0,0,0,0,0,0,0,0,],
        [1,1,0,0,0,0,0,0,0,1,1,],
        [1,1,0,0,0,0,1,1,0,1,1,],
        [1,1,0,0,0,0,1,1,1,1,1,],
        [1,1,0,0,0,1,0,0,0,1,1,],
        [1,1,0,0,1,0,0,0,0,1,1,],
        [1,1,0,0,1,0,1,0,0,1,1,],
        [1,1,0,0,1,1,1,0,0,1,1,],
        [1,1,0,1,0,1,0,1,0,0,0,],
        [1,1,0,1,0,1,0,1,0,1,1,],
        [1,1,0,1,1,0,0,0,0,0,0,],
        [1,1,0,1,1,0,0,0,0,1,1,],
        [1,1,0,1,1,0,1,1,0,1,1,],
        [1,1,0,1,1,1,1,0,0,0,0,],
        [1,1,0,1,1,1,1,0,0,1,1,],
        [1,1,0,1,1,1,1,1,0,0,0,],
        [1,1,0,1,1,1,1,1,0,1,1,],
        [1,1,0,1,1,1,1,1,1,1,1,],
        [1,1,1,0,0,0,0,0,0,0,0,],
        [1,1,1,0,0,0,0,0,0,1,1,],
        [1,1,1,0,0,0,0,0,1,1,1,],
        [1,1,1,1,0,0,0,0,0,0,0,],
        [1,1,1,1,0,0,0,0,0,1,1,],
        [1,1,1,1,0,0,0,1,1,1,1,],
        [1,1,1,1,0,0,1,1,1,1,1,],
        [1,1,1,1,1,0,0,0,0,0,0,],
        [1,1,1,1,1,0,0,0,0,1,1,],
        [1,1,1,1,1,0,0,1,1,1,1,],
        [1,1,1,1,1,0,1,1,1,1,1,],
        [1,1,1,1,1,1,0,0,1,1,1,],
        [1,1,1,1,1,1,1,1,1,1,1,],]
    //each room in LoZ is made up of 16 columns of 11 tiles. 
    //each 16 integers in each row of the nested arrays represent a room 
    //by containing 16 indexes to columns stored in the column_data nested array
    let rooms_as_columns = [
        0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,3,4,5,6,5,7,8,6,9,10,11,12,13,14,15,2,2,2,1,2,2,2,2,2,16,17,4,18,5,7,7,6,10,11,19,14,15,2,2,2,2,1,0,0,0,0,0,0,20,7,7,6,5,21,20,6,22,23,9,24,9,9,19,17,19,17,25,26,27,28,9,9,25,26,27,28,9,19,15,16,15,16,3,17,19,17,12,13,19,15,16,15,16,15,2,2,2,2,2,1,2,16,3,14,15,2,2,16,15,2,2,16,15,16,3,17,19,17,12,13,19,15,16,15,16,15,2,16,17,19,17,29,30,31,9,29,9,29,9,29,19,14,0,0,17,24,32,33,34,35,36,33,33,33,37,9,38,19,0,0,3,17,39,9,39,40,41,42,39,9,39,10,11,19,0,0,0,0,0,0,1,16,17,24,9,12,13,14,3,17,9,9,9,19,14,3,17,10,11,9,9,4,18,5,8,21,0,43,43,43,43,43,44,43,43,43,43,45,45,45,45,45,45,45,0,9,9,40,42,9,40,46,42,9,40,42,9,0,45,
        0,3,17,9,31,9,30,47,29,9,9,48,49,50,9,48,51,9,52,53,51,9,9,47,29,9,30,9,31,9,19,0,0,20,7,54,7,6,22,23,9,48,49,50,48,49,50,48,51,9,9,4,18,5,7,7,7,7,54,7,6,22,23,9,9,12,13,39,9,9,39,9,9,39,38,9,9,39,4,5,7,21,20,8,7,21,20,6,12,13,19,17,9,38,19,17,19,17,12,13,19,17,9,9,5,7,6,15,16,3,17,9,10,11,4,5,54,7,55,56,56,56,56,57,57,57,57,57,57,57,57,57,57,57,57,57,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,58,59,7,7,7,7,7,7,54,7,2,2,16,17,30,9,31,9,60,30,9,30,9,29,19,15,2,16,17,9,38,9,47,9,39,9,39,9,39,9,39,9,9,9,9,38,29,19,0,20,61,61,62,63,64,65,66,65,65,65,65,65,65,65,66,65,2,2,23,9,9,9,9,9,9,9,9,67,68,69,70,71,68,69,72,67,73,72,9,0,45,
        74,74,75,76,77,77,76,77,77,76,77,77,76,77,78,78,78,78,77,76,77,77,76,77,77,76,77,77,76,77,79,79,0,0,80,81,81,81,82,83,84,85,81,81,81,80,0,0,0,17,9,29,30,29,38,19,0,0,17,9,9,38,9,9,9,9,39,19,17,39,12,13,39,9,47,39,12,13,39,9,9,9,39,47,38,39,12,13,39,9,24,39,9,47,19,0,0,17,86,86,9,19,14,3,17,87,64,65,63,64,65,63,64,65,63,64,65,63,45,88,89,89,89,64,65,63,90,90,91,91,92,92,92,92,93,94,94,95,95,96,95,97,98,95,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,100,100,100,100,100,100,100,100,100,100,100,100,100,99,99,100,100,100,100,100,100,100,100,100,100,100,100,100,99,99,9,9,9,47,9,25,26,101,101,27,28,9,5,7,7,7,7,7,54,6,9,9,12,102,102,103,104,104,104,104,104,104,104,104,105,105,105,105,105,105,106,107,45,45,45,45,45,45,74,78,108,109,78,108,110,109,78,108,109,78,78,74,74,74,
        74,74,111,112,111,111,112,111,111,112,111,111,112,111,113,78,78,114,111,112,111,111,112,111,111,112,111,111,112,111,115,115,14,3,17,4,18,5,7,54,6,10,11,4,18,15,2,2,2,16,80,81,80,81,116,81,80,81,80,81,80,116,0,0,0,17,39,9,39,9,39,9,86,87,90,90,90,90,64,117,117,117,117,117,66,65,63,64,65,65,65,63,64,65,65,63,64,63,89,89,64,65,63,64,63,45,45,45,45,45,45,45,45,0,9,48,49,50,48,118,51,52,53,51,9,9,2,119,119,119,119,119,119,119,120,102,102,95,98,95,121,95,95,122,0,17,9,123,9,124,125,126,126,125,127,9,123,9,19,0,0,0,128,128,128,128,128,129,129,128,128,128,128,128,128,99,99,128,128,128,128,128,128,128,128,128,128,128,129,129,0,0,130,131,132,133,134,133,135,136,137,133,134,133,138,139,140,130,141,142,143,142,143,142,144,102,102,144,142,143,142,145,142,141,0,0,146,147,147,147,147,147,147,103,104,104,104,104,104,104,104,104,104,104,104,105,148,105,106,107,45,45,45,45,45,45,
        74,74,149,150,151,151,150,151,151,150,151,151,150,151,152,78,78,78,151,150,151,151,150,151,151,150,151,151,150,151,79,79,0,17,9,153,9,32,33,154,154,33,37,9,153,9,19,0,0,17,9,123,9,124,125,126,126,125,127,9,123,9,19,0,0,17,9,123,24,123,9,86,102,155,156,156,156,156,45,45,45,0,9,9,157,158,9,157,159,158,9,157,158,9,0,45,160,160,160,160,160,160,161,162,163,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,165,165,165,166,102,102,167,167,167,167,141,141,141,141,141,167,168,167,169,169,102,102,169,169,169,169,169,169,169,170,131,132,171,172,173,134,174,174,134,173,175,134,140,170,131,169,142,176,142,142,142,143,142,145,142,141,141,102,102,141,141,130,131,171,172,171,172,177,178,179,179,180,171,172,181,182,183,169,184,145,102,145,184,143,184,184,145,184,143,102,145,184,169,169,185,167,167,167,144,167,167,167,167,144,167,167,167,185,141,0,0,20,6,12,102,102,102,102,186,119,45,119,45,45,45,
        74,74,187,187,187,187,187,187,187,187,187,187,187,187,188,74,122,98,95,121,95,121,95,121,95,121,94,94,189,189,189,189,189,189,95,95,190,191,191,192,192,191,191,191,191,191,190,190,190,190,95,95,94,94,97,102,102,94,193,94,95,94,98,189,169,169,167,142,142,143,167,184,184,194,163,165,165,163,195,195,195,195,163,163,196,160,160,162,197,163,198,163,198,163,195,195,195,195,195,165,165,165,166,184,184,167,145,167,145,145,167,167,167,167,167,176,167,176,167,143,167,143,167,176,167,143,167,143,143,167,143,142,176,142,143,102,102,143,142,143,142,176,142,169,169,169,169,169,169,169,169,102,102,199,200,200,200,200,200,200,200,200,200,201,201,201,202,142,142,142,142,167,167,145,142,167,167,102,145,102,102,102,145,102,145,102,143,167,102,184,167,203,203,203,203,203,204,205,205,205,205,205,205,205,142,169,169,169,169,169,169,102,169,169,169,169,169,169,169,169,102,169,169,169,131,132,134,134,173,171,172,175,140,170,131,132,173,134,140,130,0,0,20,6,12,102,102,102,102,186,119,45,119,45,45,45,
        122,122,206,206,206,206,206,206,206,206,206,206,206,206,98,189,189,189,189,189,189,189,189,189,189,189,102,102,189,189,189,189,189,189,189,189,189,207,102,94,122,207,207,207,207,207,98,98,98,98,95,208,206,206,121,102,102,102,208,102,209,102,98,189,170,131,132,174,174,139,173,175,138,174,174,139,138,174,139,134,134,138,174,210,102,211,211,174,174,174,212,174,213,174,139,134,134,134,134,212,212,212,212,175,213,213,213,214,215,215,140,170,131,132,134,216,134,216,134,215,215,140,132,134,216,134,140,170,131,132,145,102,143,102,176,102,102,143,102,176,102,143,102,169,169,185,145,167,167,143,167,184,184,217,165,165,165,165,165,165,165,165,165,165,165,165,166,184,184,184,184,167,145,167,184,167,167,184,145,184,184,184,145,184,145,184,143,142,102,142,185,169,169,169,169,169,218,141,185,167,167,167,167,167,184,203,203,203,203,203,167,184,205,205,205,205,205,205,141,205,218,169,169,169,169,185,167,143,143,143,167,176,176,167,145,145,145,145,167,167,13,9,9,24,12,102,102,102,102,186,45,45,45,45,45,45,
        0,16,3,17,219,220,221,222,220,221,222,223,219,219,219,219,219,219,219,224,225,219,219,219,219,224,226,226,225,19,14,3,189,189,227,227,227,227,192,192,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,206,206,206,209,206,95,206,98,189,131,132,228,228,229,228,229,230,231,232,229,228,229,228,140,130,130,132,233,234,235,160,160,236,237,228,238,228,237,228,228,228,228,228,239,228,228,239,228,228,237,228,238,240,241,241,170,181,182,183,242,243,233,228,240,241,241,244,245,245,245,245,182,182,183,131,145,184,145,184,143,184,184,143,184,143,184,143,184,167,246,247,248,249,21,20,250,246,251,252,251,219,19,15,2,2,16,15,16,3,17,19,17,250,246,19,15,16,15,16,15,2,2,16,15,2,16,3,17,87,90,90,90,89,89,89,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,64,65,63,64,65,65,65,63,64,65,63,64,63,64,63,64,65,65,63,89,89,89,253,254,45,45,45,45,45,45,
    ]

    let rooms_as_collision_columns = [
        38,38,38,38,38,38,38,33,36,36,36,36,36,36,36,36,36,31,27,34,34,34,34,33,34,9,9,9,9,9,31,36,36,36,36,33,36,36,36,36,36,36,28,27,30,34,34,34,34,9,9,28,31,36,36,36,36,36,33,38,38,38,38,38,38,37,34,34,34,34,37,37,34,30,27,9,9,9,9,28,28,28,28,15,22,22,15,9,9,15,22,22,15,9,28,36,36,36,36,31,28,28,28,9,9,28,36,36,36,36,36,36,36,36,36,36,33,36,36,31,31,36,36,36,36,36,36,36,36,36,36,31,28,28,28,9,9,28,36,36,36,36,36,36,36,28,28,28,12,14,17,9,12,9,12,9,12,28,31,38,38,28,9,22,22,22,25,22,22,22,22,22,9,8,28,38,38,31,28,14,9,14,19,18,19,14,9,14,9,9,28,38,38,38,38,38,38,33,36,28,9,9,9,9,31,31,28,9,9,9,28,31,31,28,9,9,9,9,27,30,34,33,37,38,38,38,38,38,38,33,38,38,38,38,38,38,38,38,38,38,38,38,9,9,19,19,9,19,18,19,9,19,19,9,38,38,
        38,31,28,9,17,9,14,1,12,9,9,19,20,10,9,19,19,9,10,20,19,9,9,1,12,9,14,9,17,9,28,38,38,37,34,1,34,34,30,27,9,19,20,10,19,20,10,19,19,9,9,27,30,34,34,34,34,34,1,34,34,30,27,9,9,9,9,14,9,9,14,9,9,14,8,9,9,14,27,34,34,37,37,33,34,37,37,34,9,9,28,28,9,8,28,28,28,28,9,9,28,28,9,9,34,34,34,36,36,31,28,9,9,9,27,34,1,34,38,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,34,34,34,34,34,34,1,34,36,36,36,28,14,9,17,9,0,14,9,14,9,12,28,36,36,36,28,9,8,9,1,9,14,9,14,9,14,9,14,9,9,9,9,8,12,28,38,37,33,33,36,32,32,32,4,32,32,32,32,32,32,32,4,32,36,36,27,9,9,9,9,9,9,9,9,19,19,10,20,19,19,10,10,19,20,10,9,38,38,
        38,38,26,16,8,8,16,8,8,16,8,8,16,8,9,9,9,9,8,16,8,8,16,8,8,16,8,8,16,8,38,38,38,38,9,14,14,14,19,18,19,19,14,14,14,9,38,38,38,28,9,12,14,12,8,28,38,38,28,9,9,8,9,9,9,9,14,28,28,14,9,9,14,9,1,14,9,9,14,9,9,9,14,1,8,14,9,9,14,9,9,14,9,1,28,38,38,28,8,8,9,28,31,31,28,11,32,32,32,32,32,32,32,32,32,32,32,32,38,4,4,4,4,32,32,32,11,11,11,11,11,11,11,11,11,8,8,9,9,17,9,14,28,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,1,9,15,22,22,22,22,15,9,34,34,34,34,34,34,1,34,9,9,9,0,0,34,34,34,34,34,34,34,34,34,33,33,33,33,33,33,33,38,38,38,38,38,38,38,38,9,19,19,9,19,18,19,9,19,19,9,9,38,38,38,
        38,38,0,5,0,0,5,0,0,5,0,0,5,0,9,9,9,9,0,5,0,0,5,0,0,5,0,0,5,0,31,31,31,31,28,27,30,34,34,1,34,9,9,27,30,36,36,36,36,36,9,14,9,14,1,14,9,14,9,14,9,1,38,38,38,28,14,9,14,9,14,9,8,11,11,11,11,11,32,38,38,38,38,38,4,32,32,32,32,32,32,32,32,32,32,32,32,32,4,4,32,32,32,32,32,38,38,38,38,38,38,38,38,38,9,19,20,10,19,19,19,10,20,19,9,9,36,36,36,36,36,36,36,36,36,0,0,9,28,9,14,9,9,38,38,28,9,14,9,22,22,21,21,22,22,9,14,9,28,38,38,38,1,1,1,1,1,0,0,1,1,1,1,1,1,9,9,1,1,1,1,1,1,1,1,1,1,1,0,0,38,38,38,31,28,14,9,14,19,18,19,14,9,14,9,9,28,38,38,8,17,8,17,8,13,0,0,13,8,17,8,14,8,38,38,38,2,1,1,1,1,1,1,34,34,34,34,34,34,34,34,34,34,34,34,33,29,33,33,38,38,38,38,38,38,38,
        38,38,2,6,1,1,6,1,1,6,1,1,6,1,8,9,9,9,1,6,1,1,6,1,1,6,1,1,6,1,38,38,38,28,9,14,9,22,22,21,21,22,22,9,14,9,28,38,38,28,9,14,9,22,22,21,21,22,22,9,14,9,28,38,38,28,9,14,9,14,9,8,0,38,38,38,38,38,38,38,38,38,9,9,19,19,9,19,18,19,9,19,19,9,38,38,38,38,38,38,38,38,38,33,33,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,34,34,34,34,0,0,9,9,9,9,38,38,38,38,38,9,12,9,31,31,0,0,31,31,31,31,31,31,31,31,31,28,9,9,14,9,1,1,9,14,9,9,28,31,31,31,8,12,8,8,8,17,8,14,8,38,38,0,0,38,38,38,31,9,9,9,9,34,1,34,34,34,9,9,36,36,36,31,1,14,0,14,1,17,1,1,14,1,17,0,14,1,31,31,28,9,9,9,13,9,9,9,9,13,9,9,9,28,38,38,38,37,34,9,0,0,0,0,38,36,38,36,38,38,38,
        38,38,33,33,33,33,33,33,33,33,33,33,33,33,1,38,38,28,9,14,9,14,9,14,9,14,8,8,31,31,31,31,31,31,9,9,24,23,23,7,7,23,23,23,23,23,24,24,24,24,9,9,8,8,14,0,0,8,12,8,9,8,28,31,31,31,9,8,8,17,9,1,1,33,33,34,34,33,36,36,36,36,33,33,33,38,38,33,29,33,34,33,34,33,36,36,36,36,36,34,34,34,34,1,1,9,14,9,14,14,9,9,9,9,9,12,9,12,9,17,9,17,9,12,9,17,9,17,17,9,17,8,12,8,17,0,0,17,8,17,8,12,8,31,31,31,31,31,31,31,31,0,0,32,32,32,32,32,32,32,32,32,32,11,11,11,11,8,8,8,8,9,9,14,8,9,9,0,14,0,0,0,14,0,14,0,17,9,0,1,9,24,24,24,24,24,23,25,25,25,25,25,25,25,8,31,31,31,31,31,31,0,31,31,31,31,31,31,31,31,0,31,31,31,31,28,9,9,14,9,9,9,28,31,31,28,14,9,28,38,38,38,37,34,9,0,0,0,0,38,36,38,36,38,38,38,
        38,38,1,1,1,1,1,1,1,1,1,1,1,1,28,31,31,31,31,31,31,31,31,31,31,31,0,0,31,31,31,31,31,31,31,31,31,3,0,8,38,3,3,3,3,3,28,28,28,28,9,17,1,1,14,0,0,0,17,0,12,0,28,31,31,31,28,1,1,9,14,9,9,1,1,9,9,1,9,9,9,9,1,1,0,36,36,1,1,1,17,1,14,1,9,9,9,9,9,17,17,17,17,9,14,14,14,9,8,8,28,31,31,28,9,17,9,17,9,8,8,28,28,9,17,9,28,31,31,28,14,0,17,0,12,0,0,17,0,12,0,17,0,31,31,28,14,9,9,17,9,1,1,34,34,34,34,34,34,34,34,34,34,34,34,34,34,1,1,1,1,9,14,9,1,9,9,1,14,1,1,1,14,1,14,1,17,8,0,8,28,31,31,31,31,31,3,38,28,9,9,9,9,9,1,24,24,24,24,24,9,1,25,25,25,25,25,25,38,25,3,31,31,31,31,28,9,17,17,17,9,12,12,9,14,14,14,14,9,9,9,9,9,9,9,0,0,0,0,38,38,38,38,38,38,38,
        38,36,31,28,9,19,20,10,19,20,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1,1,9,28,31,31,31,31,34,34,34,34,7,7,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,1,1,1,12,1,9,1,28,31,31,28,9,9,14,9,14,19,19,19,14,9,14,9,28,38,38,28,9,12,1,38,38,9,17,9,14,9,17,9,9,9,9,9,12,9,9,12,9,9,17,9,14,9,1,1,31,36,36,36,30,27,9,9,9,1,1,34,34,34,34,34,36,36,36,31,14,1,14,1,17,1,1,17,1,17,1,17,1,9,9,27,30,34,37,37,9,9,12,14,12,9,28,36,36,36,36,36,36,31,28,28,28,9,9,28,36,36,36,36,36,36,36,36,36,36,36,31,28,11,11,11,11,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,4,4,4,4,38,38,38,38,38,38,38,
    ];
    //init
    function init() {
        canvas = document.createElement("canvas");
        ctx = canvas.getContext("2d");
        canvas.width = 18*16;
        canvas.height = 13*16;
        document.body.appendChild(canvas);
        lastTime = Date.now();
        viewport = {};
        viewport.x=7; //screens
        viewport.y=7; //screens
        enemies = [];
        interactions_live = true;
        get_screen_tiles(7,7);
        sprite_sheets = { link:null, items:null, enemies:null, bosses:null, overworld_tiles:null, underworld_tiles:null };
        sprite_sheet = new Image();
        sprite_sheet.src = 'overworldtiles.png';
        sprite_sheet.onload = ()=>{
            sprite_sheets.link = new Image();
            sprite_sheets.link.src = 'link_sprite_sheet.png';
            sprite_sheets.link.onload = main;
        };
        //input handler
        (function() {
            var pressedKeys = {};

            function setKey(event, status) {
                var code = event.keyCode;
                var key;

                switch(code) {
                case 32:
                    key = 'SPACE'; break;
                case 37:
                    key = 'LEFT'; break;
                case 38:
                    key = 'UP'; break;
                case 39:
                    key = 'RIGHT'; break;
                case 40:
                    key = 'DOWN'; break;
                default:
                    // Convert ASCII codes to letters
                    key = String.fromCharCode(code);
                }

                pressedKeys[key] = status;
            }
            document.addEventListener('keydown', function(e) {
                setKey(e, true);
                e.preventDefault();
            });

            document.addEventListener('keyup', function(e) {
                setKey(e, false);
                e.preventDefault();
            });

            document.addEventListener('blur', function() {
                pressedKeys = {};
            });

            window.input = {
                isDown: function(key) {
                    return pressedKeys[key.toUpperCase()];
                }
            };
        })();
        
    };
    // The main game loop
    function main() {
        now = Date.now();
        dt = (now - lastTime) / 1000.0;

        update(dt);
        render();

        lastTime = now;
        requestAnimationFrame(main);
    };
    //render
    function render(){
        draw_screen();
        draw_enemies();
        draw_items();
        draw_link();
    }
    //update
    function update(dt){
        handle_passage_of_time();
        handle_input();
        resolve_interactions();
        determine_collisions();
        resolve_collisions();
    }
    // draws link and all items, weapons, and player sourced instances of damage
    function draw_link(){
        let sprite_height = 16; //pixels
        let sprite_width = 16; //pixels
        let sprite_index = link.walking_index;
        let sprite_direction = link.direction;
        let border_offset = 1;
        let y_offset = 0;
        if (link.direction.y == 0) {
            y_offset = 0;
        } else 
        if (link.direction.y == 1) {
            y_offset = 2;
        } else 
        if (link.direction.x == 0) {
            y_offset = 1;
        } else 
        if (link.direction.x == 1) {
            y_offset = 3;
        }
        if (link.is_attacking){
            link.current_attack_frame ++;
            let sword_position = {x:null,y:null};
            sword_position.y = link.position.y*16-8;
            sword_position.x = link.position.x*16-8;
            let sword_extension = 0;
            if ( link.current_attack_frame < link.wind_up_attack_frames ){
                sword_extension = link.current_attack_frame * 12 / link.wind_up_attack_frames ;
            }
            else if ( link.current_attack_frame >= link.wind_up_attack_frames && link.current_attack_frame <= link.attack_frames - link.recovery_attack_frames ){
                sword_extension = 12;
            }
            else if ( link.current_attack_frame >= link.attack_frames - link.recovery_attack_frames && link.current_attack_frame <= link.attack_frames ){
                sword_extension = ((link.attack_frames - link.current_attack_frame) * (12 / link.recovery_attack_frames) ) ;
            }
            else {
                link.is_attacking = false;
                link.current_attack_frame = 0;
                sword_extension = 0;
            }
            if (link.direction.y == 0) {
                sword_position.y += sword_extension;
            } else 
            if (link.direction.y == 1) {
                sword_position.y -= sword_extension;
            } else 
            if (link.direction.x == 0) {
                sword_position.x -= sword_extension;
            } else 
            if (link.direction.x == 1) {
                sword_position.x += sword_extension;
            }
            if(link.is_attacking){
                ctx.drawImage(sprite_sheets.link, 3*16, y_offset*16, 16, 16, Math.floor(sword_position.x) + border_offset, Math.floor(sword_position.y) + border_offset, 16, 16);
                
            }
            ctx.drawImage(sprite_sheets.link, 2*16, y_offset*16, 16, 16, link.position.x*16-8 + border_offset, link.position.y*16-8 + border_offset, 16, 16);
        } else {
            ctx.drawImage(sprite_sheets.link, ( ( Math.floor( link.walking_index / 10 ) % 2 ) )*16, y_offset*16, 16, 16, link.position.x*16-8 + border_offset, link.position.y*16-8 + border_offset, 16, 16);
        }
    }
    function display_tile(tile_number, destination_x, destination_y){
        let x = tile_number % 20;
        let y = (tile_number - x) / 20; //change to something more mathematically efficient
        ctx.drawImage(sprite_sheet, x*16, y*16, 16, 16, destination_x*16, destination_y*16, 16, 16);
    }
    function draw_screen(){
        //let viewport_x = viewport.x*11; //tiles
        //let viewport_y = viewport.y*16; //tiles
        let screen = get_screen_tiles(viewport.x, viewport.y);
        let viewport_w = 16; //tiles
        let viewport_h = 11; //tiles
        let border_offset = 1;
        ctx.fillRect(0, 0, 18*16, 13*16);
        for ( x = 0; x < viewport_w; x++){
            for ( y = 0; y < viewport_h; y++){
                    display_tile( screen[ x ][ y ], x + border_offset, y + border_offset );
            }
        }
    }
    function draw_enemies(){

    }
    function draw_items(){

    }
    function handle_passage_of_time(){
        //once an attack has been initiated, create the attacking source, handle its movement, and its expiration
        //when an enemy has reach 0 health, remove it
        //when an link is hit, set invulnerable and flashing momentarily
        //
    }
    function handle_input(){
        if (interactions_live){
            if (input.isDown('SPACE') && !link.is_attacking){
                if (link.equiped_weapon !== null){
                    link.is_attacking = true;
                    if (link.active_weapons == null){
                        link.active_weapons = [];
                    }
                    link.active_weapons.push ( link.equiped_weapon );
                }
                // link.damaging_instances.push({
                //     name:'sword',
                //     damage:1,
                //     x:link.position.x*16-8,
                //     y:link.position.x*16-8,
                //     dimensions:{
                //         w:16,
                //         h:4,
                //     }
                // })
            }

            if(input.isDown('DOWN') || input.isDown('s')) {
                link.potential_position.y = link.position.y + link.speed * dt;
                link.walking_index++;
                link.direction.y = 0;
                link.direction.x = null;
            }

            if(input.isDown('UP') || input.isDown('w')) {
                link.potential_position.y = link.position.y - link.speed * dt;
                link.walking_index++;
                link.direction.y = 1;
                link.direction.x = null;
            }

            if(input.isDown('LEFT') || input.isDown('a')) {
                link.potential_position.x = link.position.x - link.speed * dt;
                link.walking_index++;
                link.direction.x = 0;
                link.direction.y = null;
            }

            if(input.isDown('RIGHT') || input.isDown('d')) {
                link.potential_position.x = link.position.x + link.speed * dt;
                link.walking_index++;
                link.direction.x = 1;
                link.direction.y = null;
            }

            // if(input.isDown('SPACE') {

            // }
        }
    }
    function resolve_interactions(){

        
    }
    function collides(x, y, r, b, x2, y2, r2, b2) {
    return !(r <= x2 || x > r2 ||
             b <= y2 || y > b2);
    }

    function boxCollides(pos, size, pos2, size2) {
        return collides(pos[0], pos[1],
                        pos[0] + size[0], pos[1] + size[1],
                        pos2[0], pos2[1],
                        pos2[0] + size2[0], pos2[1] + size2[1]);
    }

    function determine_collisions(){
        collisions = {
            link_with_map : false,
            link_with_enemy : false,
            link_with_item : false,
            link_with_doorway : false,
            out_of_bounds : false,
            weapon_with_enemy : false,
        }   
        // change to use links direction to check for collision with box ahead
        if ( link.potential_position.x > 16 || link.potential_position.x < 1 || link.potential_position.y > 11 || link.potential_position.y < 1 ){
            collisions.out_of_bounds = true;
        }
        else if (room.collision_map[Math.floor(link.potential_position.x-1)][Math.floor(link.potential_position.y-1)] == 1) {
            collisions.link_with_map = true;
        }
        //collision with sword strike
        if (link.active_weapons !== null){
            for (let i in link.active_weapons){
                let weapon = link.active_weapons[i];
                for ( let ii in room.enemies ){
                    let enemy = room.enemies[ii];
                    let condition = collides( 
                        weapon.position.x + weapon.hitbox_offset.x, 
                        weapon.position.y + weapon.hitbox_offset.y, 
                        weapon.hitbox_dimensions.w, 
                        weapon.hitbox_dimensions.h,
                        enemy.position.x,
                        enemy.position.y,
                        enemy.dimensions.w,
                        enemy.dimensions.h,
                    );
                    if ( condition ){
                        if (collisions.weapon_with_enemy == false){
                            collisions.weapon_with_enemy = [];
                        }
                        weapon.collided = true;
                        collisions.weapon_with_enemy.push( { 'weapon' : weapon, 'enemy' : enemy} );
                    }
                }
            }
        }


    }
    function resolve_collisions(){
        if ( !collisions.link_with_map ){
            link.position.x = link.potential_position.x;
            link.position.y = link.potential_position.y;
        } else {
            link.potential_position.x = link.position.x;
            link.potential_position.y = link.position.y;
        }
        if(collisions.out_of_bounds){
            if (link.potential_position.x < 1 ){
                link.potential_position.x = link.position.x = 16;   
                viewport.x -= 1;
            }
            else if (link.potential_position.x > 16 ){
                link.potential_position.x = link.position.x = 1;  
                viewport.x += 1;  
            }
            else if (link.potential_position.y < 1 ){
                link.potential_position.y = link.position.y = 11;   
                viewport.y -= 1; 
            }
            else if (link.potential_position.y > 11 ){
                link.potential_position.y = link.position.y = 1;   
                viewport.y += 1; 
            }
        } 
        if ( collisions.weapon_with_enemy ){
            for (let i in collisions.weapon_with_enemy){
                collisions.weapon_with_enemy[i][1].health -= collisions.weapon_with_enemy[i][0];
            }
        }
    }
    // let img = new Image();
    // img.onload = function() {
    //     // for ( y = 0; y < 8; y++){
    //     //     for ( i = 0; i < 18; i++){
    //     //         display_tile(i+(18*y),i,y);
    //     //     }
    //     // }
    //     drawAllTiles();
    // };
    // img.src = 'overworldtiles.png';

    function display_tile(tile_number, destination_x, destination_y){
        let x = tile_number % 20;
        let y = (tile_number - x) / 20; //change to something more mathematically efficient
        ctx.drawImage(sprite_sheet, x*16, y*16, 16, 16, destination_x*16, destination_y*16, 16, 16);
    }
    
    function get_screen_tiles(screen_x,screen_y){
        let screen = [];
        let collision_map = [];
        let room_index = screen_x*16 + screen_y*256;
        for ( let columns = 0; columns < 16; columns++ ){
            screen.push( 
                column_data[ 
                    rooms_as_columns[ 
                        room_index + columns
                    ]
                ] 
            );
        }
        room.sprite_map = screen;
        for ( let columns = 0; columns < 16; columns++ ){
            collision_map.push( 
                column_collision_data[ 
                    rooms_as_collision_columns[ 
                        room_index + columns
                    ]
                ] 
            )
        }
        room.collision_map = Array.from(collision_map);
        return screen;
    }
    init();
    //function drawAllTiles(){
    //     let viewport_x = 7*11;
    //     let viewport_y = 7*16;
    //     let viewport_w = 16;
    //     let viewport_h = 11;
    //     for ( y = 0; y < viewport_w; y++){
    //         for ( x = 0; x < viewport_h; x++){
    //             display_tile(hex_arr[x+viewport_x][y+viewport_y],y,x);
    //         }
    //     }

 
//}
// (function() {
    //     var resourceCache = {};
    //     var loading = [];
    //     var readyCallbcks = [];

    //     // Load an image url or an array of image urls
    //     function load(urlOrArr) {
    //         if(urlOrArr instanceof Array) {
    //             urlOrArr.forEach(function(url) {
    //                 _load(url);
    //             });
    //         }
    //         else {
    //             _load(urlOrArr);
    //         }
    //     }

    //     function _load(url) {
    //         if(resourceCache[url]) {
    //             return resourceCache[url];
    //         }
    //         else {
    //             var img = new Image();
    //             img.onload = function() {
    //                 resourceCache[url] = img;

    //                 if(isReady()) {
    //                     readyCallbacks.forEach(function(func) { func(); });
    //                 }
    //             };
    //             resourceCache[url] = false;
    //             img.src = url;
    //         }
    //     }

    //     function get(url) {
    //         return resourceCache[url];
    //     }

    //     function isReady() {
    //         var ready = true;
    //         for(var k in resourceCache) {
    //             if(resourceCache.hasOwnProperty(k) &&
    //             !resourceCache[k]) {
    //                 ready = false;
    //             }
    //         }
    //         return ready;
    //     }

    //     function onReady(func) {
    //         readyCallbacks.push(func);
    //     }

    //     window.resources = { 
    //         load: load,
    //         get: get,
    //         onReady: onReady,
    //         isReady: isReady
    //     };
    // })();
    // resources.load([
    //     'img/sprites.png',
    //     'img/terrain.png'
    // ]);
    // resources.onReady(init);

    // function init() {
    //     terrainPattern = ctx.createPattern(resources.get('img/terrain.png'), 'repeat');

    //     document.getElementById('play-again').addEventListener('click', function() {
    //         reset();
    //     });

    //     reset();
    //     lastTime = Date.now();
    //     main();
    // };
    // enemies.push({
    //     pos: [100, 50],
    //     sprite: new Sprite(/* sprite parameters */)
    // });

    // function Sprite(url, pos, size, speed, frames, dir, once) {
    //     this.pos = pos;
    //     this.size = size;
    //     this.speed = typeof speed === 'number' ? speed : 0;
    //     this.frames = frames;
    //     this._index = 0;
    //     this.url = url;
    //     this.dir = dir || 'horizontal';
    //     this.once = once;
    // };

    // Sprite.prototype.update = function(dt) {
    //     this._index += this.speed*dt;
    // };

    // Sprite.prototype.render = function(ctx) {
    //     var frame;

    //     if(this.speed > 0) {
    //         var max = this.frames.length;
    //         var idx = Math.floor(this._index);
    //         frame = this.frames[idx % max];

    //         if(this.once && idx >= max) {
    //             this.done = true;
    //             return;
    //         }
    //     }
    //     else {
    //         frame = 0;
    //     }


    //     var x = this.pos[0];
    //     var y = this.pos[1];

    //     if(this.dir == 'vertical') {
    //         y += frame * this.size[1];
    //     }
    //     else {
    //         x += frame * this.size[0];
    //     }

    //     ctx.drawImage(resources.get(this.url),
    //                 x, y,
    //                 this.size[0], this.size[1],
    //                 0, 0,
    //                 this.size[0], this.size[1]);
    // }
    // function update(dt) {
    //     gameTime += dt;

    //     handleInput(dt);
    //     updateEntities(dt);

    //     // It gets harder over time by adding enemies using this
    //     // equation: 1-.993^gameTime
    //     if(Math.random() < 1 - Math.pow(.993, gameTime)) {
    //         enemies.push({
    //             pos: [canvas.width,
    //                 Math.random() * (canvas.height - 39)],
    //             sprite: new Sprite('img/sprites.png', [0, 78], [80, 39],
    //                             6, [0, 1, 2, 3, 2, 1])
    //         });
    //     }

    //     checkCollisions();

    //     scoreEl.innerHTML = score;
    // };
    // function handleInput(dt) {
    //     if(input.isDown('DOWN') || input.isDown('s')) {
    //         player.pos[1] += playerSpeed * dt;
    //     }

    //     if(input.isDown('UP') || input.isDown('w')) {
    //         player.pos[1] -= playerSpeed * dt;
    //     }

    //     if(input.isDown('LEFT') || input.isDown('a')) {
    //         player.pos[0] -= playerSpeed * dt;
    //     }

    //     if(input.isDown('RIGHT') || input.isDown('d')) {
    //         player.pos[0] += playerSpeed * dt;
    //     }

    //     if(input.isDown('SPACE') &&
    //     !isGameOver &&
    //     Date.now() - lastFire > 100) {
    //         var x = player.pos[0] + player.sprite.size[0] / 2;
    //         var y = player.pos[1] + player.sprite.size[1] / 2;

    //         bullets.push({ pos: [x, y],
    //                     dir: 'forward',
    //                     sprite: new Sprite('img/sprites.png', [0, 39], [18, 8]) });
    //         bullets.push({ pos: [x, y],
    //                     dir: 'up',
    //                     sprite: new Sprite('img/sprites.png', [0, 50], [9, 5]) });
    //         bullets.push({ pos: [x, y],
    //                     dir: 'down',
    //                     sprite: new Sprite('img/sprites.png', [0, 60], [9, 5]) });


    //         lastFire = Date.now();
    //     }
    // }






    //tile width in pixels 16
    //tile height in pixels 16
    //map width in tiles 256
    //map height in tiles 88
    //viewport height in tiles 11
    //viewport width in tiles 16
    //tiles 136
    //tile sheet height in tiles 8
    //tile sheet width in tiles 17

    /*
    context.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh)

    img	Source image object	Sprite sheet
    sx	Source x	Frame index times frame width
    sy	Source y	0
    sw	Source width	Frame width
    sh	Source height	Frame height
    dx	Destination x	0
    dy	Destination y	0
    dw	Destination width	Frame width
    dh	Destination height	Frame height
    */
    // for column 0 - 8 in tile sheet
    //   for column 0 - 8 in tile sheet
    //     
    
    // grab the view port offset
    // get all the tiles from the world map that fit in the viewport
    // for each tile, render them from the tile sheet using the coordinates, startng a new row each viewport width
    
    //translating 2d coordinates in =to a 1d array  [x + w*y]


   
</script>
</html>